---
layout: post
title: Mysql and SQL Server Training
subtitle: Hackerrank
cover-img: /assets/img/path.jpg
thumbnail-img: /assets/img/lala.png
share-img: /assets/img/path.jpg
tags: mysql

---


<style TYPE="text/css">
code.has-jax {font: inherit; font-size: 100%; background: inherit; border: inherit;}
</style>
<script type="text/x-mathjax-config">
MathJax.Hub.Config({
    tex2jax: {
        inlineMath: [['$','$'], ['\\(','\\)']],
        skipTags: ['script', 'noscript', 'style', 'textarea', 'pre'] // removed 'code' entry
    }
});
MathJax.Hub.Queue(function() {
    var all = MathJax.Hub.getAllJax(), i;
    for(i = 0; i < all.length; i += 1) {
        all[i].SourceElement().parentNode.className += ' has-jax';
    }
});
</script>
<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.4/MathJax.js?config=TeX-AMS_HTML-full"></script>

----------------

#### <span style="color:#4cbb17"> Bài 1: </span>

![Imgur](https://i.imgur.com/AixsxLw.png)


```sql
select * from CITY where POPULATION > 100000 and COUNTRYCODE = "USA";
```
#### <span style="color:#4cbb17"> Bài 2: </span>

![Imgur](https://i.imgur.com/g5jwpVy.png)

```sql
select NAME from CITY where POPULATION > 120000 and COUNTRYCODE = "USA";
```

#### <span style="color:#4cbb17"> Bài 3: </span>

![Imgur](https://i.imgur.com/dYKtcWq.png)

```sql
select * from CITY; 
```

#### <span style="color:#4cbb17"> Bài 4: </span>

![Imgur](https://i.imgur.com/wHlMI8t.png)

```sql
select * from CITY where ID = 1661;
```

#### <span style="color:#4cbb17"> Bài 5: </span>

![Imgur](https://i.imgur.com/VNWNv9l.png)

```sql
SELECT * FROM CITY WHERE COUNTRYCODE = "JPN";
```

#### <span style="color:#4cbb17"> Bài 6: </span>

![Imgur](https://i.imgur.com/HeHxZGd.png)

```sql
SELECT NAME FROM CITY WHERE COUNTRYCODE = "JPN";
```

#### <span style="color:#4cbb17"> Bài 7: </span>

![Imgur](https://i.imgur.com/Ni5HDYH.png)

```sql
SELECT CITY,STATE FROM STATION;
```

#### <span style="color:#4cbb17"> Bài 8: </span>

![Imgur](https://i.imgur.com/9jjNVm6.png)

```sql
SELECT DISTINCT CITY FROM STATION WHERE ID%2=0;
```

#### <span style="color:#4cbb17"> Bài 9: </span>

![Imgur](https://i.imgur.com/NDZa6p3.png)

![Imgur](https://i.imgur.com/f1a31O4.png)

```sql
SELECT COUNT(CITY) - COUNT(DISTINCT CITY) FROM STATION;
```

#### <span style="color:RED"> *** HARDER *** </span>

#### <span style="color:#4cbb17"> Bài 10: </span>

![Imgur](https://i.imgur.com/TuDo79d.png)

![Imgur](https://i.imgur.com/pc2Yrlb.png)

```sql
SELECT CITY, LENGTH(CITY) FROM STATION
ORDER BY LENGTH(CITY),CITY
LIMIT 1;

SELECT CITY, LENGTH(CITY) FROM STATION
ORDER BY LENGTH(CITY) DESC,CITY
LIMIT 1;
```

#### <span style="color:#4cbb17"> Bài 11: </span>

![Imgur](https://i.imgur.com/g0mmEqi.png)

```sql
SELECT DISTINCT CITY FROM STATION WHERE SUBSTRING(CITY,1,1) IN ('a','e','i','o','u','A','E','I','O','U'); 
```

#### <span style="color:#4cbb17"> Bài 12: </span>

![Imgur](https://i.imgur.com/JUyCT7r.png)

```sql
SELECT DISTINCT CITY FROM STATION WHERE SUBSTRING(CITY,-1,1) IN ('a','e','i','o','u','A','E','I','O','U');
```

#### <span style="color:#4cbb17"> Bài 13: </span>

![Imgur](https://i.imgur.com/QbHRsoH.png)

```sql
SELECT DISTINCT CITY FROM STATION WHERE SUBSTRING(CITY,1,1) IN ('a','e','i','o','u','A','E','I','O','U') AND SUBSTRING(CITY,-1,1) IN ('a','e','i','o','u','A','E','I','O','U');
```

#### <span style="color:#4cbb17"> Bài 14: </span>

![Imgur](https://i.imgur.com/JkxEf2p.png)

```sql
SELECT DISTINCT CITY FROM STATION WHERE SUBSTRING(CITY,1,1) NOT IN ('a','e','i','o','u','A','E','I','O','U');
```

#### <span style="color:#4cbb17"> Bài 15: </span>

![Imgur](https://i.imgur.com/OpaKV9X.png)

```sql
SELECT DISTINCT CITY FROM STATION WHERE SUBSTRING(CITY,-1,1) NOT IN ('a','e','i','o','u','A','E','I','O','U');
```

#### <span style="color:RED">*** HARDER LEVEL 2: *** </span>

#### <span style="color:#4cbb17"> Bài 16: </span>

![Imgur](https://i.imgur.com/Z5CkXqk.png)

```sql
SELECT DISTINCT CITY FROM STATION WHERE SUBSTRING(CITY,1,1) NOT IN ('a','e','i','o','u','A','E','I','O','U') OR SUBSTRING(CITY,-1,1) NOT IN ('a','e','i','o','u','A','E','I','O','U');
```

#### <span style="color:#4cbb17"> Bài 17: </span>

![Imgur](https://i.imgur.com/kzkQZJg.png)

```sql
SELECT DISTINCT CITY FROM STATION WHERE SUBSTRING(CITY,1,1) NOT IN ('a','e','i','o','u','A','E','I','O','U') AND SUBSTRING(CITY,-1,1) NOT IN ('a','e','i','o','u','A','E','I','O','U');
```

#### <span style="color:#4cbb17"> Bài 18: </span>

![Imgur](https://i.imgur.com/Hvoshzc.png)
![Imgur](https://i.imgur.com/vhJl1ra.png)

```sql
SELECT NAME FROM STUDENTS WHERE MARKS > 75
ORDER BY RIGHT(NAME,3),ID;
```

#### <span style="color:#4cbb17"> Bài 19: </span>

![Imgur](https://i.imgur.com/Tz13KJI.png)
![Imgur](https://i.imgur.com/uU3vr7j.png)

```sql
SELECT NAME FROM EMPLOYEE
ORDER BY NAME;
```

#### <span style="color:#4cbb17"> Bài 20: </span>

![Imgur](https://i.imgur.com/X5oHJGr.png)
![Imgur](https://i.imgur.com/62FS9gU.png)

```sql
SELECT NAME FROM EMPLOYEE WHERE SALARY > 2000 AND MONTHS < 10
ORDER BY EMPLOYEE_ID;
```

#### <span style="color:RED">*** HARDER LEVEL 3: *** </span>

#### <span style="color:#4cbb17"> Bài 21: </span>

![Imgur](https://i.imgur.com/L3w3Rff.png)

```sql
SET @TEMP:=21; 
SELECT REPEAT('* ', @TEMP:= @TEMP - 1) 
FROM INFORMATION_SCHEMA.TABLES;
```

#### <span style="color:#4cbb17"> Bài 22: </span>

![Imgur](https://i.imgur.com/WP7vPKo.png)

```sql
SET @TEMP:=0; 
SELECT REPEAT('* ', @TEMP:= @TEMP + 1) 
FROM INFORMATION_SCHEMA.TABLES
WHERE @TEMP < 20;
```

#### <span style="color:#4cbb17"> Bài 23: </span>

![Imgur](https://i.imgur.com/FybJXJk.png)
![Imgur](https://i.imgur.com/HYRXkRL.png)

```sql
SELECT CASE
            WHEN A+B>C AND B+C>A AND A+C>B THEN
                CASE
                    WHEN A=B AND B=C THEN 'Equilateral'
                    WHEN A=B OR B=C OR A=C THEN 'Isosceles'
                    ELSE 'Scalene'
                END
            ELSE 'Not A Triangle'
            END
FROM TRIANGLES;
```
#### <span style="color:#4cbb17"> Bài 24: </span>

![Imgur](https://i.imgur.com/rlqzZbq.png)
![Imgur](https://i.imgur.com/HsifW2G.png)
![Imgur](https://i.imgur.com/D14Xl7e.png)

```sql
SELECT CONCAT(NAME,'(',LEFT(OCCUPATION,1),')') FROM OCCUPATIONS 
ORDER BY NAME;
SELECT CONCAT('There are a total of ',COUNT(OCCUPATION),' ',LOWER(OCCUPATION),'s.') AS TOTAL FROM OCCUPATIONS
GROUP BY OCCUPATION ORDER BY TOTAL;
```

#### <span style="color:#4cbb17"> ***** Note ***** </span>

~~~
GROUP BY: Là sort lại và chỉ lấy cái đại diện thôi còn ORDER BY: thì cũng sắp xếp lại và lấy luôn những cái giống nhau !
~~~

#### <span style="color:#4cbb17"> (**) Bài 25: </span>

![Imgur](https://i.imgur.com/5n7K5JR.png)
![Imgur](https://i.imgur.com/MbmefDj.png)
![Imgur](https://i.imgur.com/sj0JkSW.png)

Solution: [Don't see example because input not example]

** Step 1: ** 

Create a virtual table in your head of data given to us. It look like us:

![Imgur](https://i.imgur.com/eBBn6CN.png)

```sql
SELECT
    case when Occupation='Doctor' then Name end as Doctor,
    case when Occupation='Professor' then Name end as Professor,
    case when Occupation='Singer' then Name end as Singer,
    case when Occupation='Actor' then Name end as Actor
FROM OCCUPATIONS
```

Explanation: `END AS` in `mysql`

```sql
SELECT OrderID, Quantity,
CASE WHEN Quantity > 30 THEN 'The quantity is greater than 30'
WHEN Quantity = 30 THEN 'The quantity is 30'
ELSE 'The quantity is under 30'
END AS QuantityText
FROM OrderDetails;
```

![Imgur](https://i.imgur.com/80rZqet.png)

** Step 2: **

Create an index column with respect to occupation as "RowNumber"

![Imgur](https://i.imgur.com/PaC7sEQ.png)

Notice from the image, under professor column, the first Name is indexed as 1, the next name "Birtney" as 2. That is what I mean by index w.r.t occupation.

The below code will only give the "RowNumber" column, to get the result like in image proceed to step 3

```
set @r1=0, @r2=0, @r3=0, @r4=0;

SELECT case 
	when Occupation='Doctor' then (@r1:=@r1+1)
        when Occupation='Professor' then (@r2:=@r2+1)
        when Occupation='Singer' then (@r3:=@r3+1)
        when Occupation='Actor' then (@r4:=@r4+1) end as RowNumber

FROM OCCUPATIONS
```

** Step 3: **

Combine the result from step 1 and step 2:
  
```sql
set @r1=0, @r2=0, @r3=0, @r4=0;

SELECT case 
	when Occupation='Doctor' then (@r1:=@r1+1)
        when Occupation='Professor' then (@r2:=@r2+1)
        when Occupation='Singer' then (@r3:=@r3+1)
        when Occupation='Actor' then (@r4:=@r4+1) end as RowNumber,
        case when Occupation='Doctor' then Name end as Doctor,
        case when Occupation='Professor' then Name end as Professor,
        case when Occupation='Singer' then Name end as Singer,
        case when Occupation='Actor' then Name end as Actor

FROM OCCUPATIONS

```

** Step 4: **

Now, Order_by name the Group_By RowNumber

Using Min/Max, if there is a name, it will return it, if not, return NULL.

```sql
set @r1=0, @r2=0, @r3=0, @r4=0;
select min(Doctor), min(Professor), min(Singer), min(Actor)
from(
  select case when Occupation='Doctor' then (@r1:=@r1+1)
            when Occupation='Professor' then (@r2:=@r2+1)
            when Occupation='Singer' then (@r3:=@r3+1)
            when Occupation='Actor' then (@r4:=@r4+1) end as RowNumber,
    case when Occupation='Doctor' then Name end as Doctor,
    case when Occupation='Professor' then Name end as Professor,
    case when Occupation='Singer' then Name end as Singer,
    case when Occupation='Actor' then Name end as Actor
  from OCCUPATIONS
  order by Name
	) temp
group by RowNumber;
```

#### <span style="color:#4cbb17"> Bài 25: </span>

![Imgur](https://i.imgur.com/KvKJ5R0.png)
![Imgur](https://i.imgur.com/vrokwqr.png)
![Imgur](https://i.imgur.com/N9uD7fk.png)
![Imgur](https://i.imgur.com/Hj7oIc5.png)
![Imgur](https://i.imgur.com/wHIQc8o.png)

```sql
select c.company_code, c.founder, 
    count(distinct l.lead_manager_code), count(distinct s.senior_manager_code), 
    count(distinct m.manager_code),count(distinct e.employee_code) 
from Company c, Lead_Manager l, Senior_Manager s, Manager m, Employee e 
where c.company_code = l.company_code 
    and l.lead_manager_code=s.lead_manager_code 
    and s.senior_manager_code=m.senior_manager_code 
    and m.manager_code=e.manager_code 
group by c.company_code, c.founder 
order by c.company_code;
```

#### <span style="color:Red"> Super Hard (Join)</span>

#### <span style="color:#4cbb17"> Bài 26: </span>

![Imgur](https://i.imgur.com/Y6n05lk.png)
![Imgur](https://i.imgur.com/BotlVG9.png)
![Imgur](https://i.imgur.com/7lrlAlC.png)
![Imgur](https://i.imgur.com/l4rZ7mo.png)

```sql
SELECT h.hacker_id, h.name, t1.total_score
FROM( 
    SELECT hacker_id, SUM(max_score) AS total_score
    FROM(
        SELECT hacker_id, MAX(score) AS max_score
        FROM Submissions
        GROUP BY hacker_id, challenge_id
    ) t
    GROUP BY hacker_id
) t1
JOIN Hackers h 
ON h.hacker_id = t1.hacker_id 
WHERE t1.total_score <>0 
ORDER BY total_score DESC, hacker_id;
```

#### <span style="color:#4cbb17"> Bài 27: </span>

![Imgur](https://i.imgur.com/VHWrYaS.png)

```sql
SELECT ROUND(LONG_W,4)
FROM STATION
WHERE LAT_N = (SELECT MIN(LAT_N) FROM STATION WHERE LAT_N >38.7780);
```

#### <span style="color:#4cbb17"> Bài 28: </span>

![Imgur](https://i.imgur.com/TjXHJyO.png)

```sql
SELECT 
    ROUND(ABS(MAX(LAT_N)-MIN(LAT_N))+ABS(MAX(LONG_W)-MIN(LONG_W)),4)
FROM STATION;
```

#### <span style="color:#4cbb17"> Bài 29: </span>

![Imgur](https://i.imgur.com/cTGYVOt.png)

```sql
select 
    round(sqrt(
        power((max(LAT_N)-min(LAT_N)),2) + 
        power((max(LONG_W)-min(LONG_W)),2)
    ),4)
from STATION;
```

#### <span style="color:#4cbb17"> Bài 30: </span>

![Imgur](https://i.imgur.com/kGMA0IG.png)

```sql
Select round(S.LAT_N,4) from station AS S where (select count(Lat_N) from station where Lat_N < S.LAT_N ) = (select count(Lat_N) from station where Lat_N > S.LAT_N);
```

~~~
Note: AS là dùng để viết tắt tên bảng khi tên bảng dài quá, và dùng S.LAT_N là để đối tượng đang được nhắc tới !
~~~

#### <span style="color:#4cbb17"> Bài 31: </span>

![Imgur](https://i.imgur.com/tOd4z9D.png)

```sql
SELECT ROUND(AVG(POPULATION),0) FROM CITY;
```
#### <span style="color:#4cbb17"> Bài 32: </span>

![Imgur](https://i.imgur.com/iMeIsPN.png)

```sql
select sum(population) from city where countrycode = "JPN";
```

#### <span style="color:#4cbb17"> Bài 33: </span>

![Imgur](https://i.imgur.com/nBUQA1y.png)

```sql
select abs(max(population)-min(population)) from city;
```

#### <span style="color:#4cbb17"> Bài 34: </span>

![Imgur](https://i.imgur.com/mseiUxa.png)

```sql
select count(population) from CITY where population > 100000;
```

#### <span style="color:#4cbb17"> Bài 35: </span>

![Imgur](https://i.imgur.com/QluKPM7.png)

```sql
select sum(population) from city where district = "California";
```

#### <span style="color:#4cbb17"> Bài 36: </span>

![Imgur](https://i.imgur.com/zeyDzpC.png)

```sql
select avg(population) from city where district = "California";
```

#### <span style="color:#4cbb17"> Bài 37: </span>

![Imgur](https://i.imgur.com/29MQvhp.png)
![Imgur](https://i.imgur.com/7CK3Sid.png)
![Imgur](https://i.imgur.com/t4lTT5N.png)

```sql
select ceil(avg(salary)-avg(replace(salary,'0',''))) from employees;
```

#### <span style="color:#4cbb17"> Bài 38: </span>

![Imgur](https://i.imgur.com/UGbw19M.png)
![Imgur](https://i.imgur.com/bPFG0zR.png)
![Imgur](https://i.imgur.com/Q3zpuyT.png)

```txt
salary*month --- first to calculate total earnings we multiply month * salary

count() -- next for counting no of employees having that salary we use count()

group by 1 -- ill take simple example..consider query SELECT name , id FROM employee group by 1; in this query there are 2 columns i.e., name and id...So we have to group it by 1st column that is name.

order by earning desc -- it will order the table in desc order do that max value appears frst.

limit 1 -- it will limit the table to 1 row only. so the query displays the frst row only.
```

![Imgur](https://i.imgur.com/bUZWxVA.png)

```sql
select (salary*months) as earnings , count(*) from employee group by 1 order by earnings
desc limit 1;
```

#### <span style="color:#4cbb17"> Bài 39: </span>

![Imgur](https://i.imgur.com/F8VOkAD.png)
![Imgur](https://i.imgur.com/4GMfF0N.png)

```sql
SELECT 
    ROUND(SUM(LAT_N), 2),
    ROUND(SUM(LONG_W), 2) 
FROM STATION;
```

#### <span style="color:#4cbb17"> Bài 40: </span>

![Imgur](https://i.imgur.com/1ESoOC1.png) 

```sql
SELECT ROUND(SUM(LAT_N),4) FROM STATION WHERE 38.7880< LAT_N AND LAT_N < 137.2345;
```

#### <span style="color:#4cbb17"> Bài 41: </span>

![Imgur](https://i.imgur.com/2js7pPo.png) 

```sql
select round(max(LAT_N),4) from station where LAT_N < 137.2345;
```

#### <span style="color:#4cbb17"> Bài 42: </span>

![Imgur](https://i.imgur.com/Bw5mLhX.png)

```sql
select round(LONG_W,4) from STATION where LAT_N = (select MAX(LAT_N) from STATION where LAT_N<137.2345);
```

#### <span style="color:#4cbb17"> Bài 43: </span>

![Imgur](https://i.imgur.com/pCNROM7.png)

```sql
SELECT ROUND(LAT_N,4) FROM STATION WHERE LAT_N = (SELECT MIN(LAT_N) FROM STATION WHERE LAT_N>38.7780);
```

#### <span style="color:#4cbb17"> Bài 44: </span>

![Imgur](https://i.imgur.com/9KCeSy5.png)
![Imgur](https://i.imgur.com/bdMXyWW.png)
![Imgur](https://i.imgur.com/iTLjx3T.png)
![Imgur](https://i.imgur.com/cdfJtbA.png)
![Imgur](https://i.imgur.com/ObkANby.png)

```sql
SELECT W.ID, P.AGE, W.COINS_NEEDED, W.POWER 
FROM WANDS AS W
JOIN WANDS_PROPERTY AS P
ON (W.CODE = P.CODE)
WHERE P.IS_EVIL = 0 AND W.COINS_NEEDED = (SELECT MIN(COINS_NEEDED)
                                         FROM WANDS AS X
                                         JOIN WANDS_PROPERTY AS Y
                                         ON (X.CODE = Y.CODE)
                                         WHERE X.POWER = W.POWER AND Y.AGE = P.AGE)
ORDER BY W.POWER DESC, P.AGE DESC;  
```

#### <span style="color:#4cbb17"> Bài 44: </span>

![Imgur](https://i.imgur.com/1Yc6daG.png)

```sql
SELECT SUM(CITY.POPULATION) FROM CITY
INNER JOIN COUNTRY 
ON CITY.COUNTRYCODE = COUNTRY.CODE 
WHERE COUNTRY.CONTINENT = 'Asia';
```

#### <span style="color:#4cbb17"> Bài 45: </span>

![Imgur](https://i.imgur.com/UOvK4ZT.png)
![Imgur](https://i.imgur.com/w8lcI4j.png)

```sql
SELECT CITY.NAME FROM CITY
INNER JOIN COUNTRY
ON CITY.COUNTRYCODE = COUNTRY.CODE 
WHERE COUNTRY.CONTINENT = 'Africa';
```

#### <span style="color:#4cbb17"> Bài 46: </span>

![Imgur](https://i.imgur.com/LMkjt4Y.png)
![Imgur](https://i.imgur.com/6p2jVDC.png)

```sql
SELECT COUNTRY.CONTINENT, FLOOR(AVG(CITY.POPULATION))
FROM COUNTRY, CITY
WHERE COUNTRY.CODE = CITY.COUNTRYCODE 
GROUP BY COUNTRY.CONTINENT;
```

#### <span style="color:#4cbb17"> Bài 47: </span>

![Imgur](https://i.imgur.com/mnUHSwK.png)
![Imgur](https://i.imgur.com/NQ6mRHx.png)
![Imgur](https://i.imgur.com/eRCSCrq.png)

```sql
SELECT IF(GRADES.GRADE>=8,STUDENTS.NAME, NULL), GRADES.GRADE, STUDENTS.MARKS
FROM GRADES, STUDENTS 
WHERE STUDENTS.MARKS BETWEEN GRADES.MIN_MARK AND GRADES.MAX_MARK
ORDER BY GRADES.GRADE DESC, STUDENTS.NAME;
```

#### <span style="color:#4cbb17"> Bài 48: </span>

![Imgur](https://i.imgur.com/lhu1Gy0.png)
![Imgur](https://i.imgur.com/BbymX7a.png)
![Imgur](https://i.imgur.com/XobDELW.png)
![Imgur](https://i.imgur.com/7eVd1Q8.png)
![Imgur](https://i.imgur.com/OMMnE6o.png) 

```sql
SELECT H.HACKER_ID, H.NAME
FROM HACKERS H
INNER JOIN SUBMISSIONS S
ON H.HACKER_ID = S.HACKER_ID
INNER JOIN CHALLENGES C
ON S.CHALLENGE_ID = C.CHALLENGE_ID
INNER JOIN DIFFICULTY D
ON C.DIFFICULTY_LEVEL = D.DIFFICULTY_LEVEL
WHERE S.SCORE = D.SCORE AND C.DIFFICULTY_LEVEL = D.DIFFICULTY_LEVEL
GROUP BY H.HACKER_ID, H.NAME
HAVING COUNT(S.HACKER_ID) > 1
ORDER BY COUNT(S.HACKER_ID) DESC, S.HACKER_ID ASC;
```

#### <span style="color:#4cbb17"> Bài 49: </span>

![Imgur](https://i.imgur.com/9UIrgW7.png)
![Imgur](https://i.imgur.com/DrSRBnf.png)
![Imgur](https://i.imgur.com/CDsRqsj.png)
![Imgur](https://i.imgur.com/Q4XTmC3.png)
![Imgur](https://i.imgur.com/C20bDab.png)
![Imgur](https://i.imgur.com/9Y6ptBq.png)

```sql
SELECT H.HACKER_ID, 
       H.NAME, 
       COUNT(C.CHALLENGE_ID) AS C_COUNT
FROM HACKERS H
JOIN CHALLENGES C ON C.HACKER_ID = H.HACKER_ID
GROUP BY H.HACKER_ID, H.NAME
HAVING C_COUNT = 
    (SELECT COUNT(C2.CHALLENGE_ID) AS C_MAX
     FROM CHALLENGES AS C2
     GROUP BY C2.HACKER_ID 
     ORDER BY C_MAX DESC LIMIT 1)
OR C_COUNT IN 
    (SELECT DISTINCT C_COMPARE AS C_UNIQUE
     FROM (SELECT H2.HACKER_ID, 
                  H2.NAME, 
                  COUNT(CHALLENGE_ID) AS C_COMPARE
           FROM HACKERS H2
           JOIN CHALLENGES C ON C.HACKER_ID = H2.HACKER_ID
           GROUP BY H2.HACKER_ID, H2.NAME) COUNTS
     GROUP BY C_COMPARE
     HAVING COUNT(C_COMPARE) = 1)
ORDER BY C_COUNT DESC, H.HACKER_ID;
```

#### <span style="color:#4cbb17"> Bài 50: </span>
![Imgur](https://i.imgur.com/jOEzWjc.png)
![Imgur](https://i.imgur.com/J9j0gM2.png)
![Imgur](https://i.imgur.com/Svm9ndw.png)



```sql
-- solution 1
SET @project = 0;
SET @last_date = NULL;
SELECT MIN(start_date), MAX(end_date)
FROM (SELECT
            start_date, end_date,
            (CASE WHEN start_date = @last_date THEN @project
                  ELSE @project:=@project+1 END) AS project,
            @last_date:=end_date
            FROM (SELECT start_date, end_date FROM projects ORDER BY start_date) sorted) temp
GROUP BY project
ORDER BY COUNT(1), MIN(start_date);
-- Solution 2
SELECT start_date, MIN(end_date)
FROM (SELECT start_date FROM projects
      WHERE start_date NOT IN (SELECT end_date FROM projects)) a
      INNER JOIN
     (SELECT end_date FROM projects
      WHERE end_date NOT IN (SELECT start_date FROM projects)) b
WHERE start_date < end_date
GROUP BY start_date
ORDER BY MIN(end_date) - start_date, start_date;
```

#### <span style="color:#4cbb17"> Bài 51: </span>

![Imgur](https://i.imgur.com/ZA7fAws.png)
![Imgur](https://i.imgur.com/wByAP51.png)
![Imgur](https://i.imgur.com/uwATlwZ.png)

```sql
SELECT S.NAME 
FROM STUDENTS S
JOIN FRIENDS F ON S.ID = F.ID 
JOIN PACKAGES P1 ON S.ID = P1.ID
JOIN PACKAGES P2 ON F.FRIEND_ID = P2.ID 
WHERE P2.SALARY > P1.SALARY 
ORDER BY P2.SALARY 
```

#### <span style="color:#4cbb17"> Bài 52: </span>

![Imgur](https://i.imgur.com/Q0K81V8.png)
![Imgur](https://i.imgur.com/et80bx1.png)

```sql
SELECT X, Y FROM FUNCTIONS F1
    WHERE EXISTS(SELECT * FROM FUNCTIONS F2 WHERE F2.Y = F1.X
    AND F2.X = F1.Y AND F2.X > F1.X) AND (X != Y)
UNION
SELECT X,Y FROM FUNCTIONS F1 WHERE X = Y AND 
    ((SELECT COUNT(*) FROM FUNCTIONS WHERE X = F1.X AND Y = F1.X) > 1)
      ORDER BY X;
```

#### <span style="color:#4cbb17">(**) Bài 53: </span>

![Imgur](https://i.imgur.com/XgnOvnU.png)
![Imgur](https://i.imgur.com/o6RxUQR.png)
![Imgur](https://i.imgur.com/irPfzmO.png)
![Imgur](https://i.imgur.com/1jUmtED.png)

```sql
/*
Working Platform:- MySQL
*/
SELECT A.CONTEST_ID, A.HACKER_ID, A.NAME, 
        SUM(TOTAL_SUBMISSIONS) AS TOTAL_SUBMISSIONS, 
        SUM(TOTAL_ACCEPTED_SUBMISSIONS) AS TOTAL_ACCEPTED_SUBMISSIONS,
        SUM(TOTAL_VIEWS) AS TOTAL_VIEWS,
        SUM(TOTAL_UNIQUE_VIEWS) AS TOTAL_UNIQUE_VIEWS
FROM CONTESTS AS A
LEFT JOIN COLLEGES AS B
    ON A.CONTEST_ID = B.CONTEST_ID
LEFT JOIN CHALLENGES AS C
    ON B.COLLEGE_ID = C.COLLEGE_ID 
LEFT JOIN (SELECT CHALLENGE_ID, SUM(TOTAL_VIEWS) AS TOTAL_VIEWS, 
                  SUM(TOTAL_UNIQUE_VIEWS) AS TOTAL_UNIQUE_VIEWS
           FROM VIEW_STATS
           GROUP BY CHALLENGE_ID) AS D 
    ON C.CHALLENGE_ID = D.CHALLENGE_ID 
LEFT JOIN (SELECT CHALLENGE_ID, SUM(TOTAL_SUBMISSIONS) AS TOTAL_SUBMISSIONS, 
                  SUM(TOTAL_ACCEPTED_SUBMISSIONS) AS TOTAL_ACCEPTED_SUBMISSIONS
           FROM SUBMISSION_STATS
           GROUP BY CHALLENGE_ID) AS E
    ON C.CHALLENGE_ID = E.CHALLENGE_ID
GROUP BY A.CONTEST_ID, A.HACKER_ID, A.NAME
HAVING (TOTAL_SUBMISSIONS + TOTAL_ACCEPTED_SUBMISSIONS + TOTAL_VIEWS + TOTAL_UNIQUE_VIEWS) > 0 
ORDER BY A.CONTEST_ID;
```

#### <span style="color:#4cbb17">(**) Bài 54: </span>

![Imgur](https://i.imgur.com/9omFiXI.png)
![Imgur](https://i.imgur.com/RPecYXo.png)
![Imgur](https://i.imgur.com/C5vkKoz.png)
![Imgur](https://i.imgur.com/REqPwkR.png)

```sql
SELECT SUBMISSION_DATE,
(SELECT COUNT(DISTINCT HACKER_ID)  
 FROM SUBMISSIONS S2  
 WHERE S2.SUBMISSION_DATE = S1.SUBMISSION_DATE AND    
(SELECT COUNT(DISTINCT S3.SUBMISSION_DATE) 
 FROM SUBMISSIONS S3 WHERE S3.HACKER_ID = S2.HACKER_ID AND S3.SUBMISSION_DATE < S1.SUBMISSION_DATE) = DATEDIFF(S1.SUBMISSION_DATE , '2016-03-01')),
(SELECT HACKER_ID FROM SUBMISSIONS S2 WHERE S2.SUBMISSION_DATE = S1.SUBMISSION_DATE 
GROUP BY HACKER_ID ORDER BY COUNT(SUBMISSION_ID) DESC, HACKER_ID LIMIT 1) AS TMP,
(SELECT NAME FROM HACKERS WHERE HACKER_ID = TMP)
FROM
(SELECT DISTINCT SUBMISSION_DATE FROM SUBMISSIONS) S1
GROUP BY SUBMISSION_DATE;
```

#### <span style="color:#4cbb17">(**) Bài 55: </span>

![Imgur](https://i.imgur.com/VPFpidr.png)

```sql
   SET @number = 1;
   SET @divisor = 1;
SELECT GROUP_CONCAT(n SEPARATOR '&')
  FROM (SELECT @number := @number + 1 AS n 
          FROM information_schema.tables AS t1, information_schema.tables AS t2
         LIMIT 1000
       ) AS n1
 WHERE NOT EXISTS(SELECT *
                    FROM (SELECT @divisor := @divisor + 1 AS d
                            FROM information_schema.tables AS t3, information_schema.tables AS t4
                           LIMIT 1000
                         ) AS n2
                   WHERE MOD(n, d) = 0 AND n <> d)
```

----------------------------------------------------------

### Ngày 01-03-2022

1. Tải và cài đặt SQL EXpress 2019: Hướng dẫn cài đặt [tại đây](https://www.youtube.com/watch?v=c9NQLLboSeg)

#### Cách thức viết câu lệnh:

- Nguyên tắc người viết code: "Tnh tế trong từng câu lệnh", luôn luôn phải hiểu "Viết ra đoạn code để cho người khác đọc và hiểu được" do đó:

+ Trình bày trong khuôn khổ màn hình ngang máy tính

+ Sử dụng tab khi lùi dòng vào phía trong

+ Trình bày phải có dấu cách sau dấu ","

+ Trình bày theo khối lệnh, gọn gàng, cách dòng trong khối lệnh cho dễ quan sát

+ Các từ khoá viết hoa: SELECT ... FROM 

- Lưu ý đến Performance của đoạn lệnh:

+ Kiểm tra chỉ mục trên tất cả các field trên mệnh đề WHERE and JOIN trong câu lệnh SQL 

+ Giới hạn kích thước của bảng dữ liệu làm việc: Kiểm tra các bảng được sử dụng trong câu SELECT để có thể áp dụng lọc qua WHERE

+ Chỉ chọn các field mà trong báo cáo cần tránh thừa thông tin

+ Loại bỏ các phần tính toán trong mệnh đề WHERE và JOIN

+ Đặt Index với các Field hay được truy vấn

+ Đặt kích thước của các field theo nguyên tắc byte: 2^n 

- Đầu mã thủ tục, hàm phải có thông tin chung:

+ Người tạo

+ Ngày khởi tạo

+ Mô tả chung

- Mỗi lần đoạn mã được sửa đổi phải được ghi chú (Comment) rõ ràng:

+ Người sửa đổi

+ Ngày sửa đổi

+ Nội dung chỉnh sửa

- Các đoạn lệnh có thuật toán phức tạp cần có ghi chú rõ ràng

- Các câu ghi chú cần rõ ràng, ngắn gọn, đủ nghĩa, không dài dòng.


##### Bai tap 1:

```sql
CREATE DATABASE Tech;
GO

USE Tech

CREATE TABLE Item(
    ItemCode NVARCHAR(16),
    ItemName NVARCHAR(96),
    Unit NVARCHAR(10),
    ItemType INT,
    IsActive,
)

```